from django.shortcuts import render, get_object_or_404
from goods.models import Goods, GoodsCategory

def home(request):
    """首页：展示所有已上架商品"""
    goods_list = Goods.objects.filter(status='ON_SALE').order_by('-create_time')
    return render(request, 'home.html', {
        'goods_list': goods_list,
        'categories': GoodsCategory.objects.all()  # 分类导航
    })

def goods_detail(request, goods_id):
    """商品详情页"""
    goods = get_object_or_404(Goods, id=goods_id, status='ON_SALE')  # 仅展示上架商品
    # 关联商品图片
    goods_images = goods.images.all()
    return render(request, 'goods_detail.html', {
        'goods': goods,
        'goods_images': goods_images,
        'categories': GoodsCategory.objects.all()
    })

def category(request, cate_id=None):
    """商品分类页：可选分类筛选"""
    categories = GoodsCategory.objects.all()
    if cate_id:
        # 筛选指定分类的商品
        goods_list = Goods.objects.filter(category_id=cate_id, status='ON_SALE')
        current_cate = get_object_or_404(GoodsCategory, id=cate_id)
    else:
        # 所有分类商品
        goods_list = Goods.objects.filter(status='ON_SALE')
        current_cate = None
    
    return render(request, 'category.html', {
        'categories': categories,
        'goods_list': goods_list,
        'current_cate': current_cate
    })
